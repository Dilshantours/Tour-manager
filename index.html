<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tour Operations Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Calm Harmony -->
    <!-- Application Structure Plan: A tab-based single-page application is the most intuitive structure for this use case. It allows the user to switch between different contexts (high-level dashboard, detailed tour management, resource availability, and scheduling) without leaving the page. The default view is the 'Dashboard' for a quick operational summary. The 'Tours Manager' provides granular control over bookings. The 'Driver Roster' focuses on resource status. The 'Calendar' provides a visual, time-based overview. This structure directly maps to the user's primary tasks identified from the source report (checking status, managing bookings, assigning resources), making the workflow logical and efficient. -->
    <!-- Visualization & Content Choices: 
        - Dashboard Stats: Report Info(Tour counts, Driver Status) -> Goal(Inform) -> Viz(Dynamic text, Donut/Bar Charts) -> Interaction(Hover tooltips) -> Justification(Provides immediate, high-level KPIs) -> Library(Chart.js).
        - Confirmed Tours: Report Info(Sheet 1) -> Goal(Organize/Inform) -> Viz(Interactive HTML Table) -> Interaction(Live search, status filtering) -> Justification(Best for detailed, sortable data. Filters allow users to focus on specific tasks like managing 'Confirmed' vs 'Completed' tours.) -> Library(Vanilla JS).
        - Driver Availability: Report Info(Sheet 2) -> Goal(Compare/Inform) -> Viz(Grid of Info Cards) -> Interaction(Status filtering via buttons) -> Justification(Cards offer a more visual and scannable way to check resource status than a table.) -> Library(Vanilla JS).
        - Calendar Overview: Report Info(Sheet 3) -> Goal(Change/Relationships) -> Viz(HTML Grid-based Calendar) -> Interaction(Month navigation, hover details on tours) -> Justification(A visual calendar is the most effective way to understand scheduling, overlaps, and availability over time.) -> Library(Vanilla JS, HTML/Tailwind).
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Inter', sans-serif; }
        .tab-active { border-color: #4682B4; color: #4682B4; background-color: #F0F8FF; }
        .tab-inactive { border-color: transparent; }
        .calendar-day-head { height: 2.5rem; }
        .calendar-day { min-height: 120px; }
        .calendar-tour { font-size: 0.75rem; }
        .chart-container { position: relative; width: 100%; max-width: 500px; margin-left: auto; margin-right: auto; height: 300px; max-height: 350px; }
        @media (min-width: 768px) { .chart-container { height: 350px; max-height: 400px; } }
    </style>
</head>
<body class="bg-[#F8F7F4] text-gray-800">

    <div class="container mx-auto p-4 md:p-6 lg:p-8">
        
        <header class="mb-6">
            <h1 class="text-3xl md:text-4xl font-bold text-[#556B2F]">Tour Operations Dashboard</h1>
            <p class="text-gray-600 mt-1">Manage your Sri Lankan tours, drivers, and schedule.</p>
        </header>

        <nav class="mb-6 border-b border-gray-200">
            <ul class="flex flex-wrap -mb-px">
                <li><button id="tab-dashboard" class="nav-tab inline-block p-4 border-b-2 rounded-t-lg tab-active">Dashboard</button></li>
                <li><button id="tab-tours" class="nav-tab inline-block p-4 border-b-2 rounded-t-lg tab-inactive">Tours Manager</button></li>
                <li><button id="tab-drivers" class="nav-tab inline-block p-4 border-b-2 rounded-t-lg tab-inactive">Driver Roster</button></li>
                <li><button id="tab-calendar" class="nav-tab inline-block p-4 border-b-2 rounded-t-lg tab-inactive">Calendar</button></li>
            </ul>
        </nav>

        <main>
            <!-- Dashboard View -->
            <div id="view-dashboard" class="space-y-8">
                 <div class="p-6 bg-white rounded-lg shadow-sm">
                    <h2 class="text-xl font-semibold text-[#556B2F] mb-4">At a Glance</h2>
                    <p class="text-gray-600 mb-6">This section provides a high-level summary of your current operations. Key metrics on tours and driver availability are displayed here to give you a quick snapshot of your business activity and resource allocation.</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="bg-blue-50 p-5 rounded-lg text-center">
                            <p class="text-sm text-blue-700 font-medium">Active Tours</p>
                            <p id="stat-active-tours" class="text-3xl font-bold text-blue-900">0</p>
                        </div>
                        <div class="bg-green-50 p-5 rounded-lg text-center">
                            <p class="text-sm text-green-700 font-medium">Available Drivers</p>
                            <p id="stat-available-drivers" class="text-3xl font-bold text-green-900">0</p>
                        </div>
                        <div class="bg-yellow-50 p-5 rounded-lg text-center">
                            <p class="text-sm text-yellow-700 font-medium">Upcoming Tours (7 Days)</p>
                            <p id="stat-upcoming-tours" class="text-3xl font-bold text-yellow-900">0</p>
                        </div>
                        <div class="bg-indigo-50 p-5 rounded-lg text-center">
                            <p class="text-sm text-indigo-700 font-medium">Completed This Month</p>
                            <p id="stat-completed-tours" class="text-3xl font-bold text-indigo-900">0</p>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="p-6 bg-white rounded-lg shadow-sm">
                        <h2 class="text-xl font-semibold text-[#556B2F] mb-2">Driver Status</h2>
                         <p class="text-gray-600 mb-4">This chart shows the current breakdown of your driver roster by availability. Hover over a section to see the exact number of drivers in each category.</p>
                        <div class="chart-container"><canvas id="driverStatusChart"></canvas></div>
                    </div>
                    <div class="p-6 bg-white rounded-lg shadow-sm">
                        <h2 class="text-xl font-semibold text-[#556B2F] mb-2">Monthly Tour Volume</h2>
                        <p class="text-gray-600 mb-4">This chart visualizes the number of confirmed tours scheduled per month, helping you identify busy periods and seasonal trends. </p>
                        <div class="chart-container"><canvas id="tourVolumeChart"></canvas></div>
                    </div>
                </div>
            </div>

            <!-- Tours Manager View -->
            <div id="view-tours" class="hidden space-y-6">
                 <div class="p-6 bg-white rounded-lg shadow-sm">
                     <h2 class="text-xl font-semibold text-[#556B2F] mb-4">Tours Manager</h2>
                     <p class="text-gray-600 mb-6">Here you can view and manage all your tour bookings. Use the search bar to find a specific client or the filter buttons to narrow down the list by tour status. This provides a detailed log of all your business activities.</p>
                    <div class="flex flex-col md:flex-row gap-4 mb-4">
                        <input type="text" id="tour-search" placeholder="Search by Client Name..." class="w-full md:w-1/3 p-2 border border-gray-300 rounded-lg">
                        <div id="tour-status-filters" class="flex items-center gap-2">
                            <button class="filter-btn-tour bg-[#4682B4] text-white px-4 py-2 rounded-lg" data-status="All">All</button>
                            <button class="filter-btn-tour bg-white text-gray-700 px-4 py-2 rounded-lg border" data-status="Confirmed">Confirmed</button>
                            <button class="filter-btn-tour bg-white text-gray-700 px-4 py-2 rounded-lg border" data-status="Completed">Completed</button>
                            <button class="filter-btn-tour bg-white text-gray-700 px-4 py-2 rounded-lg border" data-status="Cancelled">Cancelled</button>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="p-3">Client</th>
                                    <th class="p-3">Dates</th>
                                    <th class="p-3">Driver</th>
                                    <th class="p-3">Vehicle</th>
                                    <th class="p-3">Status</th>
                                </tr>
                            </thead>
                            <tbody id="tours-table-body">
                                <!-- JS will populate this -->
                            </tbody>
                        </table>
                    </div>
                 </div>
            </div>

            <!-- Driver Roster View -->
            <div id="view-drivers" class="hidden space-y-6">
                 <div class="p-6 bg-white rounded-lg shadow-sm">
                    <h2 class="text-xl font-semibold text-[#556B2F] mb-4">Driver Roster</h2>
                    <p class="text-gray-600 mb-6">This section provides a live overview of your driver and vehicle fleet. Use the filters to quickly see who is available, currently on a tour, or unavailable for other reasons. Each card provides key details for quick resource assignment.</p>
                    <div id="driver-status-filters" class="flex items-center gap-2 mb-4">
                        <button class="filter-btn-driver bg-[#4682B4] text-white px-4 py-2 rounded-lg" data-status="All">All</button>
                        <button class="filter-btn-driver bg-white text-gray-700 px-4 py-2 rounded-lg border" data-status="Available">Available</button>
                        <button class="filter-btn-driver bg-white text-gray-700 px-4 py-2 rounded-lg border" data-status="Booked">Booked</button>
                        <button class="filter-btn-driver bg-white text-gray-700 px-4 py-2 rounded-lg border" data-status="Maintenance">Maintenance</button>
                    </div>
                    <div id="driver-roster-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                        <!-- JS will populate this -->
                    </div>
                </div>
            </div>

            <!-- Calendar View -->
            <div id="view-calendar" class="hidden">
                 <div class="p-6 bg-white rounded-lg shadow-sm">
                    <h2 class="text-xl font-semibold text-[#556B2F] mb-4">Scheduling Calendar</h2>
                    <p class="text-gray-600 mb-6">This interactive calendar provides a visual representation of all scheduled tours. You can navigate between months to check for availability, identify busy periods, and prevent scheduling conflicts. Tours are displayed across their duration, giving a clear view of driver and vehicle assignments over time.</p>
                    <div class="flex justify-between items-center mb-4">
                        <button id="prev-month" class="px-4 py-2 bg-[#D2B48C] text-white rounded-lg">&lt; Prev</button>
                        <h3 id="calendar-month-year" class="text-lg font-semibold"></h3>
                        <button id="next-month" class="px-4 py-2 bg-[#D2B48C] text-white rounded-lg">Next &gt;</button>
                    </div>
                    <div id="calendar-grid" class="grid grid-cols-7 gap-px bg-gray-200 border border-gray-200">
                       <!-- JS will populate this -->
                    </div>
                 </div>
            </div>
        </main>

    </div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    
    const mockTours = [
        { tourId: 'SLT-2025-06-01', clientName: 'Alice Johnson', contact: 'alice@email.com', startDate: '2025-06-28', endDate: '2025-07-05', pax: 2, vehicleType: 'Car', driverAssigned: 'Kamal Perera', vehicleAssigned: 'WP CAB-1234', status: 'Completed', notes: 'Honeymoon trip.' },
        { tourId: 'SLT-2025-07-01', clientName: 'Bob Williams', contact: 'bob@email.com', startDate: '2025-07-02', endDate: '2025-07-10', pax: 4, vehicleType: 'Van', driverAssigned: 'Sunil Fernando', vehicleAssigned: 'SP LAK-5678', status: 'Completed', notes: 'Family with 2 kids.' },
        { tourId: 'SLT-2025-07-02', clientName: 'Charlie Brown', contact: 'charlie@email.com', startDate: '2025-07-12', endDate: '2025-07-20', pax: 3, vehicleType: 'Car', driverAssigned: 'Nimal Silva', vehicleAssigned: 'WP CAR-2233', status: 'Confirmed', notes: 'Photography tour.' },
        { tourId: 'SLT-2025-07-03', clientName: 'Diana Miller', contact: 'diana@email.com', startDate: '2025-07-18', endDate: '2025-07-25', pax: 6, vehicleType: 'Van', driverAssigned: 'Ravi Jayasuriya', vehicleAssigned: 'WP VAN-8877', status: 'Confirmed', notes: '' },
        { tourId: 'SLT-2025-07-04', clientName: 'Eva Green', contact: 'eva@email.com', startDate: '2025-07-28', endDate: '2025-08-05', pax: 2, vehicleType: 'Car', driverAssigned: 'Kamal Perera', vehicleAssigned: 'WP CAB-1234', status: 'Confirmed', notes: 'Needs airport pickup.' },
        { tourId: 'SLT-2025-08-01', clientName: 'Frank White', contact: 'frank@email.com', startDate: '2025-08-01', endDate: '2025-08-10', pax: 5, vehicleType: 'Van', driverAssigned: 'Sunil Fernando', vehicleAssigned: 'SP LAK-5678', status: 'Confirmed', notes: '' },
        { tourId: 'SLT-2025-08-02', clientName: 'Grace Lee', contact: 'grace@email.com', startDate: '2025-08-15', endDate: '2025-08-22', pax: 2, vehicleType: 'Car', driverAssigned: 'Nimal Silva', vehicleAssigned: 'WP CAR-2233', status: 'Confirmed', notes: 'Elderly couple.' },
        { tourId: 'SLT-2025-06-02', clientName: 'Henry Taylor', contact: 'henry@email.com', startDate: '2025-06-15', endDate: '2025-06-22', pax: 4, vehicleType: 'Van', driverAssigned: 'Ravi Jayasuriya', vehicleAssigned: 'WP VAN-8877', status: 'Cancelled', notes: 'User cancelled.' },
    ];

    const mockDrivers = [
        { name: 'Kamal Perera', vehicle: 'WP CAB-1234', type: 'Car', status: 'Available', availableFrom: '', remarks: '' },
        { name: 'Sunil Fernando', vehicle: 'SP LAK-5678', type: 'Van', status: 'Available', availableFrom: '', remarks: '' },
        { name: 'Nimal Silva', vehicle: 'WP CAR-2233', type: 'Car', status: 'Booked', availableFrom: '2025-07-21', remarks: 'On tour with Charlie Brown' },
        { name: 'Ravi Jayasuriya', vehicle: 'WP VAN-8877', type: 'Van', status: 'Booked', availableFrom: '2025-07-26', remarks: 'On tour with Diana Miller' },
        { name: 'Ajith Bandara', vehicle: 'CP VAN-4567', type: 'Van', status: 'Maintenance', availableFrom: '2025-07-22', remarks: 'Engine check' },
        { name: 'Saman Kumara', vehicle: 'WP CAR-9900', type: 'Car', status: 'Available', availableFrom: '', remarks: '' }
    ];

    const today = new Date('2025-07-19T11:09:00+05:30'); // Fixed date for consistent demo
    let currentCalendarDate = new Date(today.getFullYear(), today.getMonth(), 1);

    const tabs = document.querySelectorAll('.nav-tab');
    const views = {
        dashboard: document.getElementById('view-dashboard'),
        tours: document.getElementById('view-tours'),
        drivers: document.getElementById('view-drivers'),
        calendar: document.getElementById('view-calendar'),
    };

    function switchView(viewId) {
        Object.values(views).forEach(view => view.classList.add('hidden'));
        tabs.forEach(tab => {
            tab.classList.remove('tab-active');
            tab.classList.add('tab-inactive');
        });
        
        views[viewId].classList.remove('hidden');
        document.getElementById(`tab-${viewId}`).classList.add('tab-active');
        document.getElementById(`tab-${viewId}`).classList.remove('tab-inactive');
    }

    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            const viewId = tab.id.split('-')[1];
            switchView(viewId);
        });
    });

    function getStatusClass(status) {
        switch (status) {
            case 'Confirmed': return 'bg-blue-100 text-blue-800';
            case 'Completed': return 'bg-green-100 text-green-800';
            case 'Cancelled': return 'bg-red-100 text-red-800';
            case 'Available': return 'bg-green-100 text-green-800';
            case 'Booked': return 'bg-yellow-100 text-yellow-800';
            case 'Maintenance': return 'bg-gray-100 text-gray-800';
            default: return 'bg-gray-100 text-gray-800';
        }
    }

    function formatDate(dateStr) {
        const date = new Date(dateStr);
        return date.toLocaleDateString('en-CA');
    }

    function updateDriverStatusFromTours() {
        const todayStr = today.toISOString().split('T')[0];
        const updatedDrivers = JSON.parse(JSON.stringify(mockDrivers)); // Deep copy

        updatedDrivers.forEach(driver => {
            const activeTour = mockTours.find(tour => 
                tour.driverAssigned === driver.name &&
                tour.startDate <= todayStr &&
                tour.endDate >= todayStr &&
                tour.status === 'Confirmed'
            );

            if (activeTour) {
                driver.status = 'Booked';
                driver.availableFrom = new Date(new Date(activeTour.endDate).getTime() + 86400000).toISOString().split('T')[0];
                driver.remarks = `On tour with ${activeTour.clientName}`;
            } else if (driver.status === 'Booked') {
                // If not on an active tour, but status is booked, check if it's a future booking
                const futureTour = mockTours.find(tour => 
                    tour.driverAssigned === driver.name &&
                    tour.startDate > todayStr &&
                    tour.status === 'Confirmed'
                );
                if (!futureTour) {
                     driver.status = 'Available';
                     driver.availableFrom = '';
                     driver.remarks = '';
                }
            }
        });
        return updatedDrivers;
    }

    const currentDrivers = updateDriverStatusFromTours();

    function renderToursTable(filterText = '', filterStatus = 'All') {
        const tableBody = document.getElementById('tours-table-body');
        tableBody.innerHTML = '';

        const filteredTours = mockTours.filter(tour => {
            const matchesText = tour.clientName.toLowerCase().includes(filterText.toLowerCase());
            const matchesStatus = filterStatus === 'All' || tour.status === filterStatus;
            return matchesText && matchesStatus;
        });
        
        if (filteredTours.length === 0) {
             tableBody.innerHTML = `<tr><td colspan="5" class="text-center p-6 text-gray-500">No tours found.</td></tr>`;
             return;
        }

        filteredTours.forEach(tour => {
            const row = document.createElement('tr');
            row.className = 'border-b hover:bg-gray-50';
            row.innerHTML = `
                <td class="p-3">
                    <div class="font-medium">${tour.clientName}</div>
                    <div class="text-sm text-gray-500">${tour.contact}</div>
                </td>
                <td class="p-3">${formatDate(tour.startDate)} - ${formatDate(tour.endDate)}</td>
                <td class="p-3">${tour.driverAssigned}</td>
                <td class="p-3">${tour.vehicleAssigned} (${tour.vehicleType})</td>
                <td class="p-3"><span class="px-2 py-1 text-xs font-medium rounded-full ${getStatusClass(tour.status)}">${tour.status}</span></td>
            `;
            tableBody.appendChild(row);
        });
    }

    function renderDriverRoster(filterStatus = 'All') {
        const rosterGrid = document.getElementById('driver-roster-grid');
        rosterGrid.innerHTML = '';
        
        const filteredDrivers = currentDrivers.filter(driver => filterStatus === 'All' || driver.status === filterStatus);
        
        if (filteredDrivers.length === 0) {
            rosterGrid.innerHTML = `<p class="text-center col-span-full p-6 text-gray-500">No drivers match this status.</p>`;
            return;
        }

        filteredDrivers.forEach(driver => {
            const card = document.createElement('div');
            card.className = 'bg-white border rounded-lg p-4 shadow-sm';
            let availabilityInfo = '';
            if (driver.status !== 'Available') {
                availabilityInfo = `<p class="text-xs text-gray-500 mt-1">Available from: ${formatDate(driver.availableFrom)}</p>`;
            }

            card.innerHTML = `
                <div class="flex justify-between items-start">
                    <h4 class="font-semibold">${driver.name}</h4>
                    <span class="px-2 py-1 text-xs font-medium rounded-full ${getStatusClass(driver.status)}">${driver.status}</span>
                </div>
                <p class="text-sm text-gray-600">${driver.vehicle} (${driver.type})</p>
                ${availabilityInfo}
                <p class="text-xs text-gray-500 mt-2 italic">${driver.remarks || ''}</p>
            `;
            rosterGrid.appendChild(card);
        });
    }
    
    function renderCalendar() {
        const grid = document.getElementById('calendar-grid');
        grid.innerHTML = '';

        const year = currentCalendarDate.getFullYear();
        const month = currentCalendarDate.getMonth();

        document.getElementById('calendar-month-year').textContent = currentCalendarDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

        const daysOfWeek = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        daysOfWeek.forEach(day => {
            const dayEl = document.createElement('div');
            dayEl.className = 'calendar-day-head flex items-center justify-center bg-gray-100 font-semibold text-sm text-gray-600';
            dayEl.textContent = day;
            grid.appendChild(dayEl);
        });

        const firstDayOfMonth = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();

        for (let i = 0; i < firstDayOfMonth; i++) {
            grid.appendChild(document.createElement('div')).className = 'bg-gray-50';
        }

        for (let i = 1; i <= daysInMonth; i++) {
            const dayCell = document.createElement('div');
            dayCell.className = 'calendar-day bg-white p-2 border-t border-r border-gray-200 overflow-hidden relative';
            dayCell.innerHTML = `<span class="text-sm font-medium">${i}</span>`;
            
            const currentDate = new Date(year, month, i);
            const currentDateStr = currentDate.toISOString().split('T')[0];
            
            mockTours.forEach(tour => {
                if(tour.status !== 'Confirmed' && tour.status !== 'Completed') return;

                const tourStart = new Date(tour.startDate);
                const tourEnd = new Date(tour.endDate);

                if (currentDate >= tourStart && currentDate <= tourEnd) {
                    const tourEl = document.createElement('div');
                    const color = tour.status === 'Confirmed' ? 'bg-blue-500' : 'bg-green-500';
                    tourEl.className = `calendar-tour text-white p-1 rounded my-1 truncate ${color}`;
                    tourEl.textContent = tour.clientName;
                    tourEl.title = `${tour.clientName} (${tour.driverAssigned})`;
                    dayCell.appendChild(tourEl);
                }
            });
            
            grid.appendChild(dayCell);
        }
    }

    function updateDashboardStats() {
        const todayStr = today.toISOString().split('T')[0];
        const sevenDaysLaterStr = new Date(today.getTime() + 7 * 86400000).toISOString().split('T')[0];
        const firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1).toISOString().split('T')[0];

        const activeTours = mockTours.filter(t => t.status === 'Confirmed' && t.startDate <= todayStr && t.endDate >= todayStr).length;
        const availableDrivers = currentDrivers.filter(d => d.status === 'Available').length;
        const upcomingTours = mockTours.filter(t => t.status === 'Confirmed' && t.startDate > todayStr && t.startDate <= sevenDaysLaterStr).length;
        const completedThisMonth = mockTours.filter(t => t.status === 'Completed' && t.endDate >= firstDayOfMonth && t.endDate <= todayStr).length;

        document.getElementById('stat-active-tours').textContent = activeTours;
        document.getElementById('stat-available-drivers').textContent = availableDrivers;
        document.getElementById('stat-upcoming-tours').textContent = upcomingTours;
        document.getElementById('stat-completed-tours').textContent = completedThisMonth;
    }
    
    function renderCharts() {
        const driverStatusCtx = document.getElementById('driverStatusChart').getContext('2d');
        const tourVolumeCtx = document.getElementById('tourVolumeChart').getContext('2d');
        
        const driverCounts = currentDrivers.reduce((acc, driver) => {
            acc[driver.status] = (acc[driver.status] || 0) + 1;
            return acc;
        }, {});
        
        new Chart(driverStatusCtx, {
            type: 'doughnut',
            data: {
                labels: Object.keys(driverCounts),
                datasets: [{
                    data: Object.values(driverCounts),
                    backgroundColor: ['#90EE90', '#FFD700', '#D3D3D3', '#ADD8E6'], // LightGreen, Gold, LightGrey, LightBlue
                    borderColor: '#F8F7F4',
                    borderWidth: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { position: 'bottom' } }
            }
        });

        const tourMonths = mockTours.filter(t=>t.status==='Confirmed').reduce((acc, tour) => {
            const month = new Date(tour.startDate).toLocaleString('default', { month: 'short', year: '2-digit' });
            acc[month] = (acc[month] || 0) + 1;
            return acc;
        }, {});

        const sortedMonths = Object.keys(tourMonths).sort((a, b) => {
            const [monA, yearA] = a.split(' ');
            const [monB, yearB] = b.split(' ');
            return new Date(`1 ${monA} 20${yearA}`) - new Date(`1 ${monB} 20${yearB}`);
        });

        const sortedCounts = sortedMonths.map(month => tourMonths[month]);

        new Chart(tourVolumeCtx, {
            type: 'bar',
            data: {
                labels: sortedMonths,
                datasets: [{
                    label: 'Confirmed Tours',
                    data: sortedCounts,
                    backgroundColor: '#4682B4', // SteelBlue
                    borderRadius: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }
            }
        });
    }

    document.getElementById('tour-search').addEventListener('input', (e) => {
        const activeFilter = document.querySelector('#tour-status-filters .bg-\\[\\#4682B4\\]').dataset.status;
        renderToursTable(e.target.value, activeFilter);
    });
    
    document.querySelectorAll('.filter-btn-tour').forEach(button => {
        button.addEventListener('click', () => {
            document.querySelectorAll('.filter-btn-tour').forEach(btn => {
                btn.classList.remove('bg-[#4682B4]', 'text-white');
                btn.classList.add('bg-white', 'text-gray-700');
            });
            button.classList.add('bg-[#4682B4]', 'text-white');
            button.classList.remove('bg-white', 'text-gray-700');
            const searchText = document.getElementById('tour-search').value;
            renderToursTable(searchText, button.dataset.status);
        });
    });

    document.querySelectorAll('.filter-btn-driver').forEach(button => {
        button.addEventListener('click', () => {
            document.querySelectorAll('.filter-btn-driver').forEach(btn => {
                btn.classList.remove('bg-[#4682B4]', 'text-white');
                btn.classList.add('bg-white', 'text-gray-700');
            });
            button.classList.add('bg-[#4682B4]', 'text-white');
            button.classList.remove('bg-white', 'text-gray-700');
            renderDriverRoster(button.dataset.status);
        });
    });

    document.getElementById('prev-month').addEventListener('click', () => {
        currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
        renderCalendar();
    });

    document.getElementById('next-month').addEventListener('click', () => {
        currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
        renderCalendar();
    });
    
    function init() {
        switchView('dashboard');
        renderToursTable();
        renderDriverRoster();
        renderCalendar();
        updateDashboardStats();
        renderCharts();
    }

    init();
});
</script>
</body>
</html>
